<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
</head>
<body>

    <div class="overlay" id="overlay"></div>
    
    <nav class="navi">
        <ul class="navmenu">
            <li class="navitems"><a href="" style="color:#ec4899"><i class="fas fa-tasks"></i> Todo List</a></li>
            <li class="navitems"><button class="todo" id="list-btn">List</button></li>
        </ul>
    </nav>
    <div class="contain" id="contain">
        <div class="todohead">
            <h1 class="top">Your Professional Task Manager</h1>
            <p>Organize your tasks with style and efficiency</p>
        </div>
        
        <div class="inputbox">
            <div class="input-group">
                <input id="inbox" class="in" placeholder="Enter your task" type="text">
                <select id="priority-select">
                    <option value="low">Low Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="high">High Priority</option>
                </select>
                <input type="date" id="task-date" class="date-input">
                <button onclick="addbox()" class="add">ADD TASK</button>
            </div>
        </div>
        
        <div class="tasks-container" id="tasks-container">
        
        </div>
    
    
        <div class="list-section" id="list-section">
            <button class="close-list" onclick="toggleList()"><i class="fas fa-times"></i></button>
            <h2 class="list-title">Task History</h2>
            <table class="tasks-table">
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Due Date</th>
                    </tr>
                </thead>
                <tbody id="list-table-body">
                
                </tbody>
            </table>
        </div>
    </div>

    <script>

        document.getElementById('task-date').valueAsDate = new Date();
        

        let allTasks = JSON.parse(localStorage.getItem("allTasks") || "[]");
        let currentTasks = JSON.parse(localStorage.getItem("tasks") || "[]");
        
        function showTasks() {
            const contain = document.getElementById("tasks-container");
            contain.innerHTML = ""; 
            currentTasks.forEach((task, idx) => {
                makeTask(task.text, task.priority, task.completed, idx, task.date);
            });
        }

        function getTasks() {
            return currentTasks;
        }
       
        function saveTasks(tasks) {
            currentTasks = tasks;
            localStorage.setItem("tasks", JSON.stringify(tasks));
            
    
            const currentTaskTexts = tasks.map(t => t.text);
            
    
            tasks.forEach(task => {
                if (!allTasks.some(t => t.text === task.text && t.date === task.date)) {
                    allTasks.push({...task});
                }
            });
            
            localStorage.setItem("allTasks", JSON.stringify(allTasks));
        }

        function makeTask(text, priority, completed, idx, date) {
            var contain = document.getElementById("tasks-container");
            var newdiv = document.createElement("div");
            newdiv.classList.add("newd");

            let checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.checked = completed;
            checkbox.addEventListener("change", function() {
                label.classList.toggle("completed", this.checked);
                let tasks = getTasks();
                tasks[idx].completed = this.checked;
                
        
                const allTaskIndex = allTasks.findIndex(t => t.text === text && t.date === date);
                if (allTaskIndex !== -1) {
                    allTasks[allTaskIndex].completed = this.checked;
                    localStorage.setItem("allTasks", JSON.stringify(allTasks));
                }
                
                saveTasks(tasks);
            
                if (document.getElementById("list-section").style.display === "block") {
                    showList();
                }
            });

            let label = document.createElement("span");
            label.textContent = text;
            label.classList.add("task-text");
            if (completed) label.classList.add("completed");

            const priorityBadge = document.createElement("span");
            priorityBadge.classList.add("task-priority", `priority-${priority}`);
            if(priority === "low") priorityBadge.textContent = "Low";
            if(priority === "medium") priorityBadge.textContent = "Medium";
            if(priority === "high") priorityBadge.textContent = "High";
            
            const dateBadge = document.createElement("span");
            dateBadge.textContent = date || "No date";
            dateBadge.style.fontSize = "14px";
            dateBadge.style.color = "var(--grey)";

            const taskContent = document.createElement("div");
            taskContent.classList.add("task-content");

            const taskActions = document.createElement("div");
            taskActions.classList.add("task-actions");

            const deleteBtn = document.createElement("button");
            deleteBtn.classList.add("delete-btn");
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
            deleteBtn.addEventListener("click", function() {
            
                const taskToDelete = currentTasks[idx];
                const allTaskIndex = allTasks.findIndex(t => t.text === taskToDelete.text && t.date === taskToDelete.date);
                
                if (allTaskIndex !== -1) {
            
                    allTasks[allTaskIndex].deleted = true;
                } else {

                    taskToDelete.deleted = true;
                    allTasks.push(taskToDelete);
                }
                
                localStorage.setItem("allTasks", JSON.stringify(allTasks));
                
            
                let tasks = getTasks();
                tasks.splice(idx, 1);
                saveTasks(tasks);
                showTasks();
                
            
                if (document.getElementById("list-section").style.display === "block") {
                    showList();
                }
            });

            taskContent.appendChild(checkbox);
            taskContent.appendChild(label);
            taskContent.appendChild(priorityBadge);
            taskContent.appendChild(dateBadge);
            
            taskActions.appendChild(deleteBtn);
            
            newdiv.appendChild(taskContent);
            newdiv.appendChild(taskActions);
            
            contain.appendChild(newdiv);
        }

        function addbox() {
            const inbox = document.getElementById("inbox");
            const text = inbox.value.trim();
            const priority = document.getElementById("priority-select").value;
            const date = document.getElementById("task-date").value;
            
            if (text === "") {
                alert("Please enter a task");
                return;
            }
            
            let tasks = getTasks();
            tasks.push({text, priority, completed: false, date});
            saveTasks(tasks);
            showTasks();
            
            inbox.value = "";
        }

        const listBtn = document.getElementById("list-btn");
        const listSection = document.getElementById("list-section");
        const overlay = document.getElementById("overlay");
        
        function toggleList() {
            if (listSection.style.display === "block") {
                listSection.style.display = "none";
                overlay.style.display = "none";
            } else {
                listSection.style.display = "block";
                overlay.style.display = "block";
                showList();
            }
        }
        
        listBtn.addEventListener("click", toggleList);
        overlay.addEventListener("click", toggleList);
        
        function showList() {
            const tableBody = document.getElementById("list-table-body");
            tableBody.innerHTML = "";
            
            
            const sortedTasks = [...allTasks].sort((a, b) => {
                if (a.date < b.date) return 1;
                if (a.date > b.date) return -1;
                return 0;
            });
            
            sortedTasks.forEach(task => {
                const row = document.createElement("tr");
                
    
                const taskCell = document.createElement("td");
                taskCell.textContent = task.text;
                if (task.completed) taskCell.style.textDecoration = "line-through";
                row.appendChild(taskCell);
                
            
                const priorityCell = document.createElement("td");
                priorityCell.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                priorityCell.classList.add(`priority-text-${task.priority}`);
                row.appendChild(priorityCell);
                
                
                const statusCell = document.createElement("td");
                if (task.completed) {
                    statusCell.textContent = "Completed";
                    statusCell.classList.add("status-completed");
                } else {
                    statusCell.textContent = "Pending";
                    statusCell.classList.add("status-pending");
                }
                row.appendChild(statusCell);
                
        
                const dateCell = document.createElement("td");
                dateCell.textContent = task.date || "No date";
                row.appendChild(dateCell);
                
                tableBody.appendChild(row);
            });
        }
        
    
        showTasks();
    </script>
</body>
</html>